---
const timelineSteps = [
  {
    title: "Seguridad financiera",
    icon: "fas fa-shield-alt",
    description:
      "Protegemos transacciones de usuarios y comercios con tecnología segura y transparente.",
  },
  {
    title: "Cashless",
    icon: "fas fa-money-bill-wave",
    description:
      "Facilitamos pagos digitales para reducir el uso de efectivo y mejorar el control.",
  },
  {
    title: "Cobros rápidos",
    icon: "fas fa-stopwatch",
    description:
      "Optimiza los tiempos de cobro en puntos de venta físicos con soluciones ágiles.",
  },
  {
    title: "Visibilidad total",
    icon: "fas fa-chart-line",
    description:
      "Monitorea cada pago con datos en tiempo real para tomar decisiones informadas.",
  },
];
---

<!-- title -->
<div class="pt-20 px-4 md:px-6 text-center">
  <h2 class="text-2xl md:text-3xl font-bold text-neutral-700 text-balance">
    Nuestro <span class="text-yellow-500">valor agregado</span>
  </h2>
  <p class="mt-2 text-sm md:text-lg text-neutral-600">
    Conoce cómo nuestros productos transforman la manera de realizar pagos.
  </p>
</div>

<section class="relative w-full max-w-6xl mx-auto px-4 py-24">
  <!-- Fondo sutil -->
  <div class="absolute inset-0 z-0 pointer-events-none overflow-hidden" aria-hidden="true">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_rgba(255,255,224,0.14)_0%,_transparent_70%)]"></div>
    <div class="absolute top-1/3 left-1/4 w-[520px] h-[520px] bg-yellow-100 rounded-full blur-3xl opacity-30"></div>
    <div class="absolute bottom-0 right-1/4 w-[420px] h-[420px] bg-primary/30 rounded-full blur-2xl opacity-20"></div>
  </div>

  <!-- Línea central + progreso -->
  <div class="absolute top-0 left-1/2 -translate-x-1/2 hidden sm:block w-[3px] h-full z-0">
    <div class="absolute inset-0 bg-gradient-to-b from-secondary via-yellow-400 to-secondary opacity-40 rounded-full"></div>
    <div id="tl-progress" class="absolute left-0 top-0 w-full h-0 bg-yellow-400 rounded-full will-change-[height]"></div>
  </div>

  <div class="relative z-10 space-y-16">
    {timelineSteps.map((step, index) => {
      const isLeft = index % 2 === 0;
      return (
        <div
          class={`flex flex-col sm:flex-row ${isLeft ? "sm:justify-start" : "sm:justify-end"} items-center relative`}
          data-gsap="fade-up"
        >
          {/* Columna izquierda (texto cuando index par) */}
          <div class={`hidden sm:flex items-center w-1/2 ${isLeft ? "justify-end pr-8 text-right" : "justify-end pr-8"}`}>
            {isLeft && (
              <article class="max-w-sm bg-white/95 border border-neutral-200 rounded-2xl p-5 shadow-md backdrop-blur-sm">
                <h4 class="font-semibold text-xl text-neutral-800">{step.title}</h4>
                <p class="text-sm text-neutral-700 mt-2">{step.description}</p>
              </article>
            )}
          </div>

          {/* Bead central */}
          <div class="relative z-10 will-change-transform">
            <span class="pointer-events-none absolute inset-0 -m-2 rounded-full bg-yellow-400/25 blur-md"></span>
            <div
              class="w-20 h-20 bg-white border-4 border-yellow-400 rounded-full flex items-center justify-center shadow-xl text-yellow-500"
              data-gsap="bead-pop"
              aria-hidden="true"
            >
              <i class={`${step.icon} text-3xl`}></i>
            </div>
          </div>

          {/* Columna derecha (texto cuando index impar) */}
          <div class={`hidden sm:flex items-center w-1/2 ${!isLeft ? "justify-start pl-8 text-left" : "justify-start pl-8"}`}>
            {!isLeft && (
              <article class="max-w-sm bg-white/95 border border-neutral-200 rounded-2xl p-5 shadow-md backdrop-blur-sm">
                <h4 class="font-semibold text-xl text-neutral-800">{step.title}</h4>
                <p class="text-sm text-neutral-700 mt-2">{step.description}</p>
              </article>
            )}
          </div>

          {/* Móvil: card simple */}
          <div class="sm:hidden mt-4 text-center w-full px-2">
            <article class="bg-white border border-neutral-200 rounded-2xl p-5 shadow-md">
              <h4 class="font-semibold text-lg text-neutral-900">{step.title}</h4>
              <p class="text-sm text-neutral-700 mt-2">{step.description}</p>
            </article>
          </div>
        </div>
      );
    })}
  </div>
</section>

<style>
  @media (prefers-reduced-motion: reduce) {
    [data-gsap] { opacity: 1 !important; transform: none !important; }
  }
</style>

<script  >
  import gsap from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  gsap.registerPlugin(ScrollTrigger);

  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // Animación fade-up de cada bloque
  const rows = document.querySelectorAll('[data-gsap="fade-up"]') as NodeListOf<HTMLElement>;
  if (!prefersReduced) {
    rows.forEach((el, i) => {
      gsap.fromTo(el, { autoAlpha: 0, y: 56 }, {
        autoAlpha: 1, y: 0, duration: 0.8, delay: i * 0.08, ease: 'power2.out',
        scrollTrigger: { trigger: el, start: 'top 80%', toggleActions: 'play none none none' }
      });
    });
  } else {
    rows.forEach((el) => { el.style.opacity = '1'; el.style.transform = 'none'; });
  }

  // Pop suave de cada bead al entrar
  const beads = document.querySelectorAll('[data-gsap="bead-pop"]');
  if (!prefersReduced) {
    beads.forEach((b) => {
      gsap.fromTo(b, { scale: 0.9 }, {
        scale: 1, duration: 0.6, ease: 'back.out(1.6)',
        scrollTrigger: { trigger: b, start: 'top 90%', toggleActions: 'play none none none' }
      });
    });
  }

  // Progreso de la línea central (solo desktop)
  const progressEl = document.getElementById('tl-progress');
  if (progressEl && !prefersReduced && window.matchMedia('(min-width: 640px)').matches) {
    const section = progressEl.closest('section');
    ScrollTrigger.create({
      trigger: section,
      start: 'top 10%',
      end: 'bottom 80%',
      onUpdate: (self) => {
        const h = Math.max(0, Math.min(1, self.progress));
        progressEl.style.height = `${h * 100}%`;
      }
    });
  }
</script>
