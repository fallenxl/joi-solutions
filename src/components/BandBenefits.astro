---
import { Image } from 'astro:assets';
import JoiPayBand from '../assets/band-1.png';
---

<section class="relative overflow-hidden px-4 md:px-20 py-20 bg-primary">
  <!-- Fondo decorativo -->
  <div aria-hidden="true" class="absolute inset-0">
    <!-- Mesh blobs -->
    <div class="absolute -top-40 -left-32 w-[28rem] h-[28rem] rounded-full opacity-35 blur-3xl
                [background:radial-gradient(60%_60%_at_50%_50%,var(--color-secondary),transparent_70%)]"></div>
    <div class="absolute -bottom-40 -right-32 w-[32rem] h-[32rem] rounded-full opacity-35 blur-3xl
                [background:radial-gradient(60%_60%_at_50%_50%,#8ad7ff,transparent_70%)]"></div>

    <!-- Grid sutil -->
    <div class="absolute inset-0 opacity-20 mix-blend-overlay"
         style="background:
           linear-gradient(0deg, rgba(255,255,255,.08) 1px, transparent 1px) 0 0 / 32px 32px,
           linear-gradient(90deg, rgba(255,255,255,.08) 1px, transparent 1px) 0 0 / 32px 32px;">
    </div>

    <!-- Glow animado -->
    <div class="absolute inset-0 pointer-events-none glow-anim"></div>
  </div>

  <div class="relative z-10 max-w-screen-xl mx-auto flex flex-col md:flex-row items-center justify-center gap-10 md:gap-20 px-6 py-14 md:p-10">
    <!-- Imagen animada -->
    <div class="w-full md:w-1/2 flex justify-center" data-gsap="img-scale" data-tilt>
      <Image
        src={JoiPayBand}
        width={420}
        height={420}
        class="w-[220px] md:w-[420px] drop-shadow-2xl will-change-transform"
        alt="Imagen de JoiPay Band"
        loading="lazy"
      />
    </div>

    <!-- Contenido -->
    <div class="w-full md:w-1/2 flex flex-col items-center md:items-start text-center md:text-left gap-6">
      <div class="backdrop-blur-md/30 bg-white border border-white/60 px-6 py-1 rounded-full text-neutral-600 text-lg font-medium shadow-md"
           data-gsap="fade-up">
        <span class="flex items-center gap-2 text-sm md:text-lg">
          <i class="fas fa-microchip text-tertiary"></i> Solución JoiSolutions
        </span>
      </div>

      <h2 class="text-3xl md:text-5xl font-semibold text-white leading-tight tracking-tight" data-gsap="fade-up">
        Transformamos la forma en que se realizan pagos
      </h2>

      <p class="text-white/80 max-w-prose" data-gsap="fade-up">
        Implementación flexible para operaciones de alto tráfico, con control y seguridad de punta a punta.
      </p>

      <!-- Tres tarjetas como la imagen -->
     <!-- Tres tarjetas (fix de layout/typografía) -->
<div
  class="grid w-full mt-2 gap-5
         grid-cols-1 md:grid-cols-2"
  role="list"
>
  {[
    {
      icon: 'fa-calendar-check',
      title: 'Eventos',
      text:
        'Agilizarás el acceso, mejorarás la gestión de tus comercios y aumentarás la seguridad en cada transacción, optimizando ventas y operaciones sin efectivo.'
    },
    {
      icon: 'fa-store',
      title: 'Centros comerciales',
      text:
        'Obtendrás información valiosa de tus clientes, impulsarás promociones exclusivas y ofrecerás un método de pago innovador gestionado por ti.'
    },
    {
      icon: 'fa-school',
      title: 'Colegios',
      text:
        'Centralizarás los pagos dentro del campus, fomentarás la educación financiera y los padres podrán gestionar las cuentas de sus hijos en tiempo real.'
    }
  ].map(({ icon, title, text }, i) => (
    <article
      role="listitem"
      class={`group h-full bg-white rounded-3xl p-6 shadow-md
             border border-white/60
             flex flex-col gap-4 items-start
             ring-1 ring-transparent hover:ring-tertiary/25 focus-within:ring-tertiary/35
             transition-all duration-300 hover:-translate-y-0.5
             ${i === 2 ? 'md:col-span-2 ' : ''}`}
      data-gsap="fade-up"
      tabindex="0"
      aria-label={title}
    >
      <header class="flex items-center  gap-3 min-w-0">
        <div
          class="size-12 rounded-xl grid place-items-center shrink-0
                 [background:conic-gradient(from_180deg_at_50%_50%,var(--color-secondary),var(--color-primary))]
                 text-white shadow-md"
          aria-hidden="true"
        >
          <i class={`fas ${icon}`}></i>
        </div>
        <h3 class="text-xl font-semibold text-neutral-900 leading-snug tracking-tight min-w-0 break-words text-left ">
          {title}
        </h3>
      </header>

      <p class="text-neutral-700 text-base md:text-[17px] leading-7">
        {text}
      </p>

    </article>
  ))}
</div>

    </div>
  </div>

  <style>
    .gradient-text {
      background: linear-gradient(45deg, var(--color-primary) 0%, var(--color-secondary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .glow-anim {
      background:
        radial-gradient(40rem 40rem at var(--gx,20%) var(--gy,30%),
          rgba(255,255,255,.18), transparent 60%);
      animation: move-glow 12s ease-in-out infinite alternate;
    }
    @keyframes move-glow {
      0%   { --gx: 20%; --gy: 30%; }
      50%  { --gx: 80%; --gy: 70%; }
      100% { --gx: 30%; --gy: 40%; }
    }
    @media (prefers-reduced-motion: reduce) {
      .glow-anim { animation: none; }
      [data-tilt] { transform: none !important; }
    }
  </style>

  <!-- GSAP en <script> HTML, sin onMount -->
<script is:inline>
  import gsap from "gsap";
  import ScrollTrigger from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // Fade-up en cascada
  const items = Array.from(document.querySelectorAll('[data-gsap="fade-up"]'));
  items.forEach((el, i) => {
    if (prefersReduced) {
      el.style.opacity = 1;
      el.style.transform = 'none';
      return;
    }
    gsap.fromTo(el, { opacity: 0, y: 36 }, {
      opacity: 1,
      y: 0,
      duration: 0.7,
      delay: i * 0.12,
      ease: 'power2.out',
      scrollTrigger: { trigger: el, start: 'top 85%', toggleActions: 'play none none none' }
    });
  });

  // Imagen: entrada + parallax + flotación + tilt
  const imgWrapper = document.querySelector('[data-gsap="img-scale"]');
  if (imgWrapper && !prefersReduced) {
    gsap.fromTo(imgWrapper, { scale: 0.9, opacity: 0 }, { scale: 1, opacity: 1, duration: 1, ease: 'power2.out' });
    gsap.to(imgWrapper, {
      y: -80,
      ease: 'none',
      scrollTrigger: { trigger: imgWrapper, start: 'top bottom', end: 'bottom top', scrub: true }
    });
    gsap.to(imgWrapper, { yPercent: -2, duration: 3.5, yoyo: true, repeat: -1, ease: 'sine.inOut' });

    // Tilt con mouse
    let rafId;
    const tilt = (e) => {
      const r = imgWrapper.getBoundingClientRect();
      const cx = r.left + r.width / 2, cy = r.top + r.height / 2;
      const dx = (e.clientX - cx) / r.width, dy = (e.clientY - cy) / r.height;
      imgWrapper.style.transform = `rotateX(${dy * -6}deg) rotateY(${dx * 6}deg)`;
      cancelAnimationFrame(rafId); rafId = requestAnimationFrame(() => {});
    };
    const resetTilt = () => { imgWrapper.style.transform = 'rotateX(0deg) rotateY(0deg)'; };

    imgWrapper.addEventListener('mousemove', tilt);
    imgWrapper.addEventListener('mouseleave', resetTilt);
  }
</script>

</section>
